<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pok√©mon Tycoon</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url('https://images.squarespace-cdn.com/content/v1/613ef8a0a3de987d28d14431/1662051124297-VAO30XSO47Z7HPVSYSEV/Pokemon_SV_Worldmap.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow: hidden;
  height: 100vh;
}

#top {
  background: rgba(255,255,255,0.9);
  padding: 10px;
  font-size: 20px;
  position: fixed;
  width: 100%;
  top: 0;
  z-index: 1000;
}

#shop {
  background: rgba(238,238,238,0.9);
  padding: 10px;
  position: fixed;
  top: 50px;
  width: 100%;
  z-index: 1000;
}

#farm {
  position: absolute;
  top: 120px;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
}

.pokemon {
  position: absolute;
  width: 96px;
  cursor: grab;
  user-select: none;
}

.pokemon:active {
  cursor: grabbing;
}

.shiny {
  filter: hue-rotate(120deg) brightness(1.2);
}

button {
  font-size: 12px;
  margin-top: 2px;
}
</style>
</head>

<body>

<div id="top">üí∞ Money: $<span id="money">100</span></div>

<div id="shop">
  <input id="search" placeholder="Search Pok√©mon (name or ID)">
  <button onclick="buyPokemon()">Buy Pok√©mon</button>
  <button onclick="resetGame()">Reset</button>
</div>

<div id="farm"></div>

<script>
let money = 100;
let ownedPokemon = [];

// drag state
let draggingIndex = null;
let dragOffsetX = 0;
let dragOffsetY = 0;
let isDragging = false;

// BUY
async function buyPokemon() {
  const input = document.getElementById("search").value.trim().toLowerCase();
  if (!input) return;

  const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${input}`);
  if (!res.ok) return alert("Pok√©mon not found");

  const data = await res.json();

  if (money < 10) return alert("Not enough money");

  money -= 10;
  updateMoney();

  const farm = document.getElementById("farm");

  ownedPokemon.push({
    id: data.id,
    name: data.name,
    img: data.sprites.front_default,
    earn: 1,
    x: Math.random() * (farm.clientWidth - 100),
    y: Math.random() * (farm.clientHeight - 100)
  });

  renderFarm();
  saveGame();
}

// RENDER
function renderFarm() {
  const farm = document.getElementById("farm");
  farm.innerHTML = "";

  ownedPokemon.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "pokemon";
    div.style.left = p.x + "px";
    div.style.top = p.y + "px";

    div.onmousedown = (e) => {
      draggingIndex = i;
      isDragging = true;
      dragOffsetX = e.offsetX;
      dragOffsetY = e.offsetY;
    };

    div.innerHTML = `
      <img src="${p.img}">
      <div>${p.name}</div>
    `;

    farm.appendChild(div);
  });
}

// DRAG MOVE
document.addEventListener("mousemove", (e) => {
  if (!isDragging || draggingIndex === null) return;

  const farm = document.getElementById("farm");
  const rect = farm.getBoundingClientRect();
  const p = ownedPokemon[draggingIndex];

  p.x = e.clientX - rect.left - dragOffsetX;
  p.y = e.clientY - rect.top - dragOffsetY;

  p.x = Math.max(0, Math.min(p.x, farm.clientWidth - 100));
  p.y = Math.max(0, Math.min(p.y, farm.clientHeight - 100));

  renderFarm();
});

document.addEventListener("mouseup", () => {
  isDragging = false;
  draggingIndex = null;
  saveGame();
});

// WANDER
function wander() {
  if (isDragging) return;

  const farm = document.getElementById("farm");

  ownedPokemon.forEach(p => {
    p.x += (Math.random() - 0.5) * 20;
    p.y += (Math.random() - 0.5) * 20;

    p.x = Math.max(0, Math.min(p.x, farm.clientWidth - 100));
    p.y = Math.max(0, Math.min(p.y, farm.clientHeight - 100));
  });

  renderFarm();
}

setInterval(wander, 1200);

// MONEY
function updateMoney() {
  document.getElementById("money").textContent = money;
}

// SAVE
function saveGame() {
  localStorage.setItem("pokeSave", JSON.stringify({ money, ownedPokemon }));
}

function loadGame() {
  const save = JSON.parse(localStorage.getItem("pokeSave"));
  if (!save) return;
  money = save.money;
  ownedPokemon = save.ownedPokemon;
  updateMoney();
  renderFarm();
}

function resetGame() {
  if (!confirm("Reset game?")) return;
  money = 100;
  ownedPokemon = [];
  localStorage.clear();
  updateMoney();
  renderFarm();
}

loadGame();
</script>

</body>
</html>
